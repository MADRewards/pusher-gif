/*! pusher-gif (v1.1.1) - Copyright: 2013, Nathan Walker <nathan.walker@infowrap.com>,Kirk Strobeck <kirk.strobeck@infowrap.com> MIT */
function base64Pusher(a){var b,c,d,e,f,g,h,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",j=a.length,k=0,l="";do b=a.charCodeAt(k),e=b>>2,c=a.charCodeAt(k+1),f=(3&b)<<4|c>>4,d=a.charCodeAt(k+2),g=k+2>j?64:(15&c)<<2|d>>6,h=k+3>j?64:63&d,l+=i.charAt(e)+i.charAt(f)+i.charAt(g)+i.charAt(h);while((k+=3)<j);return l}function bitstream(){this.bit=1,this.byte_=0,this.data="",this.write_bit=bitstream_write_bit,this.get=bitstream_get}function bitstream_write_bit(a){a&&(this.byte_|=this.bit),this.bit<<=1,256==this.bit&&(this.bit=1,this.data+=String.fromCharCode(this.byte_),this.byte_=0)}function bitstream_get(){var a="",b=this.data;for(1!=this.bit&&(b+=String.fromCharCode(this.byte_)),i=0;i<b.length+1;i+=255)chunklen=b.length-i,0>chunklen&&(chunklen=0),chunklen>255&&(chunklen=255),a+=String.fromCharCode(chunklen)+b.substring(i,i+255);return a+"\x00"}function make_glif(a,b,c,d,e,f){var g=String.fromCharCode(a%256)+String.fromCharCode(a/256)+String.fromCharCode(b%256)+String.fromCharCode(b/256);gif="GIF89a"+g+"ð\x00\x00ÿÿÿ"+String.fromCharCode(d)+String.fromCharCode(e)+String.fromCharCode(f)+"!ù\x00\x00\x00\x00,\x00\x00\x00\x00"+g+"\x00";var h=new bitstream;for(y=0;b>y;y++)for(x=0;a>x;x++)h.write_bit(c[x+a*y]),h.write_bit(0),h.write_bit(0),h.write_bit(0),h.write_bit(0),h.write_bit(1);return gif+=h.get()+";","data:image/gif;base64,"+base64Pusher(gif)}angular.module("pusher-gif",[]).factory("pusherGifService",function(){var a,b;return b=function(a,b){var c;return c=c=function(a,b){return b?c(b,a%b):a},c=c(a,b),[a/c,b/c]},a={},a.gifCache={},a.make=function(c,d){var e,f,g,h,i,j;if(i=b(Math.floor(c),Math.floor(d)),e=Math.floor(i[0]*i[1]),f=e.toString(),a.gifCache[f])return a.gifCache[f];for(h=new Array(e),g=j=1;e>j;g=j+=1)h[j]=0;return a.gifCache[f]=make_glif(i[0],i[1],h),a.gifCache[f]},a}).provider("pusherGifFPHelper",function(){var a;return a=void 0,{setFPHeaders:function(b){return a=b},$get:["$q","$http",function(b,c){var d;return d={},d.metaCache={},d.metadata=function(e){var f,g,h,i,j;return h=b.defer(),d.metaCache[e.url]?h.resolve(d.metaCache[e.url]):(i=e.url.split("?"),f=i[0],j="",i.length>1&&(j="&"+i[1]),g={method:"GET",url:""+f+"/metadata?width=true&height=true"+j},a&&(g.headers=a),c(g).then(function(a){return a&&a.data&&a.data.width&&a.data.height?(d.metaCache[e.url]={width:a.data.width,height:a.data.height},h.resolve(d.metaCache[e.url])):void 0})),h.promise},d}]}}).directive("pusherGif",["pusherGifService","pusherGifFPHelper",function(a,b){return{restrict:"A",scope:{calcWidth:"@",calcHeight:"@",constrainWidth:"@",fpFallback:"=?"},compile:function(c,d){var e,f;return d.width&&d.height&&(f=+d.width,e=+d.height,c.attr("src",a.make(f,e))),function(c,d){var g;if(g=function(b,g){return c.constrainWidth?(f=+c.constrainWidth,e=+g/+b*+c.constrainWidth):(f=+b,e=+g),d.attr("src",a.make(f,e))},_.isUndefined(d.attr("src"))){if(c.calcWidth&&c.calcHeight)return g(c.calcWidth,c.calcHeight);if(c.fpFallback)return b.metadata(c.fpFallback).then(function(a){return g(a.width,a.height)})}}}}}]);