/*! pusher-gif (v1.0.7) - Copyright: 2013, Nathan Walker <nathan.walker@infowrap.com>,Kirk Strobeck <kirk.strobeck@infowrap.com> MIT */
function base64Pusher(a){var b,c,d,e,f,g,h,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",j=a.length,k=0,l="";do b=a.charCodeAt(k),e=b>>2,c=a.charCodeAt(k+1),f=(3&b)<<4|c>>4,d=a.charCodeAt(k+2),g=k+2>j?64:(15&c)<<2|d>>6,h=k+3>j?64:63&d,l+=i.charAt(e)+i.charAt(f)+i.charAt(g)+i.charAt(h);while((k+=3)<j);return l}function bitstream(){this.bit=1,this.byte_=0,this.data="",this.write_bit=bitstream_write_bit,this.get=bitstream_get}function bitstream_write_bit(a){a&&(this.byte_|=this.bit),this.bit<<=1,256==this.bit&&(this.bit=1,this.data+=String.fromCharCode(this.byte_),this.byte_=0)}function bitstream_get(){var a="",b=this.data;for(1!=this.bit&&(b+=String.fromCharCode(this.byte_)),i=0;i<b.length+1;i+=255)chunklen=b.length-i,0>chunklen&&(chunklen=0),chunklen>255&&(chunklen=255),a+=String.fromCharCode(chunklen)+b.substring(i,i+255);return a+"\x00"}function make_glif(a,b,c,d,e,f){var g=String.fromCharCode(a%256)+String.fromCharCode(a/256)+String.fromCharCode(b%256)+String.fromCharCode(b/256);gif="GIF89a"+g+"ð\x00\x00ÿÿÿ"+String.fromCharCode(d)+String.fromCharCode(e)+String.fromCharCode(f)+"!ù\x00\x00\x00\x00,\x00\x00\x00\x00"+g+"\x00";var h=new bitstream;for(y=0;b>y;y++)for(x=0;a>x;x++)h.write_bit(c[x+a*y]),h.write_bit(0),h.write_bit(0),h.write_bit(0),h.write_bit(0),h.write_bit(1);return gif+=h.get()+";","data:image/gif;base64,"+base64Pusher(gif)}angular.module("pusher-gif",[]).factory("pusherGifService",function(){var a;return a={},a.make=function(a,b){var c,d,e,f;for(c=Math.floor(a*b),e=new Array(c),d=f=1;c>f;d=f+=1)e[f]=0;return make_glif(a,b,e)},a}).directive("pusherGif",["pusherGifService","$http",function(a,b){return{restrict:"A",scope:{calcWidth:"@",calcHeight:"@",constrainWidth:"@",fpFallback:"=?"},compile:function(c,d){var e,f;return d.width&&d.height&&(f=+d.width,e=+d.height,c.attr("src",a.make(f,e))),function(c,d){var g,h,i,j,k;if(j=function(b,g){return c.constrainWidth?(f=+c.constrainWidth,e=+g/+b*+c.constrainWidth):(f=+b,e=+g),d.attr("src",a.make(f,e))},_.isUndefined(d.attr("src"))){if(c.calcWidth&&c.calcHeight)return j(c.calcWidth,c.calcHeight);if(c.fpFallback)return i=c.fpFallback.url.split("?"),g=i[0],k="",i.length>1&&(k="&"+i[1]),h={method:"GET",url:""+g+"/metadata?width=true&height=true"+k,headers:{"X-Auth-Token":void 0}},b(h).then(function(a){return a&&a.data&&a.data.width&&a.data.height?j(a.data.width,a.data.height):void 0})}}}}}]);